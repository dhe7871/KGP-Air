<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="This is the website to see/view the pollution data over Indian Institute of Technology Kharagpur. 
        Made by IIT KGP Aero student as a part of the project for the Flight Testing Laboratory. 
        The data is collected using a fixed wing time to time and updating the data on this website on real time.">

    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        .material-symbols-outlined {
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 24;
        }
    </style>

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="uploadcsvstyle.css">
    <link rel="shortcut icon" href="KGP_Air_logo.png" type="image/x-icon">
    <title>KGP Air</title>
</head>

<body>
    <nav>
        <a href="#"><img src="KGP_Air_logo.png" alt="KGP Air"></a>
        <ul>
            <li><a href="index.html#introw">Introduction</a></li>
            <li><a href="sensors.html">Sensors</a></li>
            <li><a href="data.html">Raw Data</a></li>
            <li><a href="map.html">Visualize</a></li>
            <li><a href="index.html#teamrow">Team</a></li>
            <li><a href="#contacts">Contact</a></li>
        </ul>
        <span class="material-symbols-outlined" style="font-size: 2rem;" id="menubtn">menu</span>
    </nav>

    <div class="menudrop" id="menudrop">
        <ul>
            <li><a href="index.html#introw">Introduction</a></li>
            <li><a href="sensors.html">Sensors</a></li>
            <li><a href="data.html">Raw Data</a></li>
            <li><a href="map.html">Visualize</a></li>
            <li><a href="index.html#teamrow">Team</a></li>
            <li><a href="#contacts">Contact</a></li>
        </ul>
    </div>

    <div class="heading">
        <h1>Upload Processed CSV File</h1>
    </div>
    
    <div class="uploadsection">
        <input type="file" name="csvfiles" id="csvfiles" accept=".csv" multiple>
        <button onclick="uploadCSV()">Upload CSV Files</button>
    </div>

    <div class="uploaderrors"></div>



    <div class="footer" id="contacts">
        <div class="contact-us"><h1>Contact Us</h1></div>
        <div class="call">
            <a href="tel:+918009840947" class="callhover">
                <span class="material-symbols-outlined callhover">call</span>
                <span class="exact-contact callhover">&nbsp;+91 8009840947</span>
                <span class="contact-text callhover">&nbsp;Call Us</span>
            </a>
        </div>
        <div class="mail">
            <a href="mailto:kgp-air@gmail.com?subject=Inquiry&body=Hello, I have a question about...">
                <span class="material-symbols-outlined mailhover">mail</span>
                <span class="exact-contact mailhover">&nbsp;kgp-air@gmail.com</span>
                <span class="contact-text mailhover">&nbsp;Email Us</span>
            </a>
        </div>
        <div class="visit">
            <p id="visiters">Visiters: </p>
        </div>
        <div class="tm">
            <span>Made by Dheeraj</span>
        </div>
    </div>


    <script>
        //Setting up visit Counter
        const visiters = document.getElementById('visiters');
        const url = 'https://counterapi-d6d4drfdawacbxa4.centralindia-01.azurewebsites.net/countUp/KGPAirCounter'

        if(!localStorage.getItem('KGPAirCounter')){
            fetch(url)
            .then(response => {
                if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                localStorage.setItem('KGPAirCounter', data.count);
                visiters.innerText = `Visitors: ${localStorage.getItem('KGPAirCounter')}`;
            })
            .catch(error => {
                console.error(`Error: ${error.message}`);
            });
        }else{
            visiters.innerText = `Visitors: ${localStorage.getItem('KGPAirCounter')}`;
        }

        function uploadCSV(){
            const uploaderrors = document.getElementsByClassName('uploaderrors')[0]
            uploaderrors.innerText = 'Uploading Files....'

            const files = document.getElementById('csvfiles').files;
            const formData = new FormData();
            
            for(let i = 0; i < files.length; i++){
                formData.append('files', files[i]);
            }

            fetch('http://127.0.0.1:8000/uploadCSVFiles',{
                method: 'POST',
                body: formData
            })
            .then(res => res.json())
            .then(data => {
                console.log('Server Response:', data);
                if(data['errormessages'].length){
                    let str = '';
                    for(value of data['errormessages']){
                        str += `${value['filename']}: ${value['error']}\n`
                    }
                    uploaderrors.innerText = str;
                    uploaderrors.style.color = 'red';
                }else{
                    uploaderrors.innerText = 'All files uploaded Successfully!';
                    uploaderrors.style.color = 'green';
                }
                document.getElementById('csvfiles').value = '';
            }).catch(err=>{
                console.error('Error:', err);
            });
        }
    </script>
    <script src="script.js"></script>
</body>

</html>